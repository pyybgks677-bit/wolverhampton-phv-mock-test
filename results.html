<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Results – Wolverhampton PHV Knowledge Mock Test</title>
  <link rel="stylesheet" href="styles.css?v=8" />
</head>

<body>
  <header class="container">
    <h1>Wolverhampton PHV Knowledge Mock Test</h1>
    <p class="muted" style="max-width: 820px;">
      Results summary for your most recent attempt.
    </p>
  </header>

  <main class="container card">
    <h2>Results</h2>

    <p id="resultSummary" class="resultSummary"></p>

    <details id="reviewBox" class="hidden">
      <summary>Review incorrect questions</summary>
      <div id="reviewList" class="review"></div>
    </details>

    <div class="actions startActions">
      <a class="btn primary" href="quiz.html">Start again</a>
      <a class="btn" href="index.html">Back to home</a>
    </div>

    <p class="hint muted" style="margin-top: 12px;">
      Tip: If you cannot see results, it usually means you opened this page without completing a quiz.
    </p>
  </main>

  <footer class="container footer">
    <p class="muted">
      Offline-ready. Not affiliated with Wolverhampton Council. Practice tool only.
    </p>
    <p class="muted">
      <a href="privacy.html">Privacy Policy</a> ·
      <a href="terms.html">Terms of Use</a> ·
      <a href="disclaimer.html">Disclaimer</a>
    </p>
  </footer>

  <script>
    (function () {
      const KEY = "wolv_phv_last_result";
      const raw = localStorage.getItem(KEY);

      const summaryEl = document.getElementById("resultSummary");
      const reviewBox = document.getElementById("reviewBox");
      const reviewList = document.getElementById("reviewList");

      if (!raw) {
        summaryEl.innerHTML = "No results found. Please complete the mock test first.";
        reviewBox.classList.add("hidden");
        return;
      }

      let data;
      try {
        data = JSON.parse(raw);
      } catch {
        summaryEl.innerHTML = "No results found. Please complete the mock test first.";
        reviewBox.classList.add("hidden");
        return;
      }

      summaryEl.innerHTML =
        `Mode: <strong>${(data.mode || "").toUpperCase()}</strong><br>` +
        `Score: <strong>${data.score}/${data.total}</strong> (${Number(data.pct).toFixed(1)}%)<br>` +
        `Unanswered: <strong>${data.unanswered}</strong><br>` +
        `Result: <strong>${data.passed ? "PASS ✅" : "FAIL ❌"}</strong> (80% required)` +
        (data.timeUp ? "<br><em>Ended because time ran out.</em>" : "");

      if (Array.isArray(data.wrong) && data.wrong.length > 0) {
        reviewBox.classList.remove("hidden");
        reviewList.innerHTML = "";

        data.wrong.forEach((item, i) => {
          const div = document.createElement("div");
          div.className = "reviewItem";

          const yourLetter = item.chosen ?? "—";
          const yourText = item.yourText ?? "Unanswered";
          const correctLetter = item.correctLetter ?? "";
          const correctText = item.correctText ?? "";

          div.innerHTML =
            `<strong>${i + 1}. ${item.question}</strong><br>` +
            `Your answer: <strong>${yourLetter}</strong> — ${yourText}<br>` +
            `Correct answer: <strong>${correctLetter}</strong> — ${correctText}`;

          reviewList.appendChild(div);
        });
      } else {
        reviewBox.classList.add("hidden");
      }
    })();
  </script>
</body>
</html>
